<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>月曆展示 - 快樂旅遊網</title>
    <link href="css/bootstrap-4.4.1.css" rel="stylesheet">
    <link href="css/multiColumnTemplate.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="header"></div>
    <main>
        <h1>線上訂房月曆</h1>
        <div id="calendar">
            <div id="monthControl">
                <button id="prevMonth">上一月</button>
                <h2 id="currentMonth"></h2>
                <button id="nextMonth">下一月</button>
            </div>
            <div id="calendarGrid"></div>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $('.header').load('includes/header.html')
        // 當前年月
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;

        // 加載月曆
        function loadCalendar(year, month) {
            $.ajax({
                url: 'api/get_calendar.php',
                method: 'GET',
                data: { year, month },
                dataType: 'json',
                success: function (data) {
                    const calendarGrid = $('#calendarGrid');
                    calendarGrid.empty();

                    $('#currentMonth').text(`${year}年${month}月`);

                    // 填充日曆
                    data.forEach(day => {
                        const dayClass = day.available ? 'day available' : 'day unavailable';
                        calendarGrid.append(`
                            <div class="${dayClass}" data-date="${day.date}">
                                <span>${day.day}</span>
                                <span>剩餘房間：${day.rooms}</span>
                            </div>
                        `);
                    });
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log('HTTP status code: ' + jqXHR.status + '\n' +
                    'textStatus: ' + textStatus + '\n' +
                    'errorThrown: ' + errorThrown);
                    console.log('HTTP message body (jqXHR.responseText): ' + '\n' + jqXHR.responseText);
                    alert('無法加載月曆，請稍後再試。');
                }
            });
        }

        // 切換月份
        $('#prevMonth').on('click', function () {
            currentMonth -= 1;
            if (currentMonth === 0) {
                currentMonth = 12;
                currentYear -= 1;
            }
            loadCalendar(currentYear, currentMonth);
        });

        $('#nextMonth').on('click', function () {
            currentMonth += 1;
            if (currentMonth === 13) {
                currentMonth = 1;
                currentYear += 1;
            }
            loadCalendar(currentYear, currentMonth);
        });

        // 初始化
        $(document).ready(function () {
            loadCalendar(currentYear, currentMonth);
        });
    </script>
</body>
</html>
